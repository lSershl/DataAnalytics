### Список метрик
Наш дашборд будет состоять из следующих групп метрик:

1) Метрики по кампаниям
2) Юнит-экономика
3) Когортные метрики

### 1. Метрики по кампаниям
Так как данных в датасете немного, можно делать расчёт метрик прямо на уровне графиков.

Для начала создадим `Chart` с типом `Table` и посчитаем основные метрики по рекламным кампаниям:

![Создание таблицы](./img/04_create_table_chart.png)

Добавим в `Dimensions` столбцы `Channel`, `Campaign` и `CohortMonth`, после чего создадим метрику по столбцу `Clients` с агрегацией `MAX` (чтобы учесть всех клиентов в разрезе кампании, т. к. данные в таблице представлены в виде когорт):

![Создание метрики Клиенты](./img/05_clients_metric.png)

Аналогичным образом добавляем следующие метрики:
1) Выручка - по столбцу `RevenueUSD` с агрегацией `SUM` (нас интересует, сколько выручки принесла компания за весь период)
2) Расходы на маркетинг - по столбцу `MarketingSpendUSD` c агрегацией `MAX` (на кампанию тратились единожды)
3) Маржа - по столбцу `GrossProfitMargin` c агрегацией `SUM` (за весь период)
4) ROMI (Return on Marketing Investment) - добавляем метрику через CustomSQL по формуле:
    ```
    SUM(GrossProfitMargin) / SUM(MarketingSpendUSD)
    ```

    ![Создание метрики ROMI](./img/06_romi_metric.png)

Сохраняем получившуюся таблицу на дашборд и растягиваем, чтобы все столбцы помещались на экран:

![Таблица метрик по кампаниям](./img/07_campaigns_metrics_table.png)

### 2. Юнит-экономика
Создаём на основе предыдущей таблицы новый `Chart`, оставив те же `Dimensions` и одну метрику `Клиенты` (или же создаём полностью новый `Chart`, чтобы случайно не перезаписать предыдущий).

Добавляем новые метрики:
1) Заказы - по столбцу `Orders` с агрегацией `MAX`
2) LTV (Lifetime Value) - выручку за всё время "жизни" клиента, по следующей формуле:
    ```
    SUM(RevenueUSD) / MAX(Clients) OVER 
      (PARTITION BY CohortMonth, Channel, Campaign)
    ```

    ![Создание метрики LTV](./img/08_ltv_metric.png)

3) LTM (Lifetime Margin) - маржу за всё время "жизни" клиента, по следующей формуле:
    ```
    SUM(GrossProfitMargin) / MAX(Clients) OVER 
      (PARTITION BY CohortMonth, Channel, Campaign)
    ```

    ![Создание метрики LTM](./img/09_ltm_metric.png)

4) CAC (Customer Acquisition Cost) - стоимость привлечения клиента, по следующей формуле:
    ```
    SUM(MarketingSpendUSD) / MAX(Clients) OVER 
      (PARTITION BY CohortMonth, Channel, Campaign)
    ```

    ![Создание метрики CAC](./img/10_cac_metric.png)

5) LTV/CAC - это отношение выручки к затратам на маркетинг, по упрощенной формуле:
    ```
    SUM(RevenueUSD) / SUM(MarketingSpendUSD)
    ```

    ![Создание метрики LTV/CAC](./img/11_ltv_cac_metric.png)

Сохраняем получившуюся таблицу на дашборд:

![Таблица юнит-экономика](./img/12_unit_economy_table.png)

### 3. Когортные метрики

Создадим `Chart` с типом `Pivot Table` (сводная таблица), в столбцы добавим `OrderMonth`, а в строки - `CohortMonth` и `Campaign`.

После этого добавим метрику Клиенты по столбцу датасета `Clients` с агрегацией `MAX`, и поменяем формат дат на вкладке `Customize` на год-месяц.

![Формат дат](./img/13_yyyy_mm_date_formatting.png)

Сохраним получившуюся таблицу на дашборд как "Клиенты по когортам":

![Таблица Клиенты по когортам](./img/14_cohort_clients_table.png)

На основе этой таблицы создаём новую и заменяем метрику `Клиенты` метрикой `Возвращаемость` по формуле:

```
SUM(Clients) / MAX(Clients) OVER 
    (PARTITION BY Channel, Campaign, CohortMonth)
```

![Создание метрики Возвращаемость](./img/15_return_rate_metric.png)

И добавляем таблицу на дашборд:

![Таблица Возвращаемость по когортам](./img/16_cohort_return_rate_table.png)

Теперь на основе этой таблицы создаём новый `Chart` и меняем метрику `Возвращаемость` на метрику сдельного LTV по следующей формуле:

```
SUM(RevenueUSD) OVER 
    (PARTITION BY CohortMonth, Campaign 
      ORDER BY OrderMonth)
/
MAX(Clients) OVER 
    (PARTITION BY CohortMonth, Campaign 
      ORDER BY OrderMonth)
```

![Создание метрики сдельного LTV](./img/17_cohort_avg_ltv_metric.png)

Добавляем таблицу на дашборд:

![Таблица сдельного LTV по когортам](./img/18_cohort_avg_ltv_table.png)

И, наконец, создаём `Chart` для выручки на пользователя по когортам.

Формула для метрики:

```
SUM(RevenueUSD) / SUM(Clients)
```

![Создание метрики Выручка в месяц на пользователя](./img/19_monthly_revenue_per_client_metric.png)

Добавляем таблицу на дашборд:

![Таблица Выручка на пользователя по когортам](./img/20_cohort_monthly_revenue_per_client_table.png)

Если оставить таблицы на дашборде как есть, он получится громоздким и неудобным для чтения, поэтому на следующем этапе нам нужно поработать над компоновкой дашборда.