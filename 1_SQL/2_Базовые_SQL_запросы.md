## Описание
В данном разделе будут применены базовые запросы SQL. Длинные результаты будут разделяться по 5 строк, если не указано иное (для экономии пространства).

#### 1. Сортировка, ORDER BY
Нам нужно определить 5 самых дорогих товаров в таблице `products`, которые доставляет наш сервис, и упорядочить их по убыванию цены.

Запрос:
``` 
SELECT name,
       price
FROM   products
ORDER BY price DESC LIMIT 5
```
Результат:

![Группировка](./img/05_group_by.png)

#### 2. Замена пустых значений, COALESCE
Нужно вывести id всех курьеров и их годы рождения, но не у всех курьеров указана дата рождения (в таблице это будет NULL). Вместо NULL значений нужно произвести замену на текстовое значение "unknown". Результат нужно отсортировать сначала по убыванию года рождения курьера, затем по возрастанию id курьера.

Запрос:
``` 
SELECT courier_id,
       COALESCE(CAST(DATE_PART('year', birth_date) AS VARCHAR), 'unknown') AS birth_year
FROM   couriers
ORDER BY birth_year DESC, courier_id
```

Результат:

![Coalesce 1](./img/06_coalesce_1.png)
![Coalesce 2](./img/06_coalesce_2.png)

#### 3. Пример арифметических функций в расчётных столбцах
Нужно рассчитать НДС (20%) каждого товара в таблице `products` и рассчитать цену без учёта НДС. Нужно вывести всю информацию о товарах, включая сумму налога и цену без его учёта. Колонки с суммой налога и ценой без НДС назвать соответственно `tax` и `price_before_tax`. Значения в этих колонках округлить до двух знаков после запятой. Результат нужно отсортиртировать сначала по убыванию цены товара без учёта НДС, затем по возрастанию id товара.

Запрос:
``` 
SELECT product_id,
       name,
       price,
       ROUND((price / 120) * 20, 2) AS tax,
       ROUND(price - ((price / 120) * 20), 2) AS price_before_tax
FROM   products
ORDER BY price_before_tax DESC, product_id
```

Результат:

![Расчёт НДС](./img/07_tax_calc.png)

#### 4. Фильтрация через WHERE
Нужно назначить скидку 20% на все товары из таблицы `products` и выбрать те товары, цена на которые с учётом скидки превышает 100 рублей. В результирующей таблице нужно вывести id товаров, их наименования, прежнюю цену и новую цену с учётом скидки. Колонку со старой ценой будет называться `old_price`, с новой — `new_price`.
Результат должен быть отсортирован по возрастанию id товара.

Запрос:
``` 
SELECT product_id,
       name,
       price AS old_price,
       price * 0.8 AS new_price
FROM   products
WHERE  price * 0.8 > 100
ORDER BY product_id
```

Результат:

![Фильтрация WHERE](./img/08_where.png)

#### 5. Дополнительная фильтрация через LIKE
Нужно составить запрос, который выбирает из таблицы `products` все чаи стоимостью больше 60 рублей и вычисляет для них цену со скидкой 25%.
Скидку в % нужно указать в отдельном столбце в формате текста, то есть вот так: «25%» (без кавычек). Столбцы со скидкой и новой ценой назовите соответственно `discount` и `new_price`.
Также необходимо любым известным способом избавиться от "чайного гриба".
Результат должен быть отсортирован по возрастанию id товара.

Запрос:
``` 
SELECT product_id,
       name,
       price,
       '25%' AS discount,
       price * 0.75 AS new_price
FROM   products
WHERE  name like '%чай%'
   and name != 'чайный гриб'
   and price > 60
ORDER BY product_id
```

Результат:

![Фильтрация LIKE](./img/09_like_filtering.png)

#### 6. Дополнительная фильтрация через IN и BETWEEN
Из таблицы `user_actions` нужно вывести всю информацию о действиях пользователей с id 170, 200 и 230 за период с 25 августа по 4 сентября 2022 года включительно. Результат нужно отсортировать по убыванию id заказа — то есть от самых поздних действий к самым первым.

Запрос:
``` 
SELECT user_id,
       order_id,
       action,
       time
FROM   user_actions
WHERE  user_id IN (170, 200, 230)
   AND time BETWEEN '2022-08-25'
   AND '2022-09-05'
ORDER BY order_id desc
```

Результат:

![Фильтрация IN BETWEEN](./img/10_in_between_filtering.png)

#### 7. Фильтрация по части даты
Из таблицы `user_actions` нужно получить id всех заказов, сделанных пользователями сервиса в августе 2022 года.
Результат нужно отсортировать по возрастанию id заказа.

Запрос:
``` 
SELECT order_id
FROM   user_actions
WHERE  action = 'create_order'
   AND date_part('month', time) = 8
   AND date_part('year', time) = 2022
ORDER BY order_id
```

Результат:

![Фильтрация DATE_PART 1](./img/11_date_part_filtering_1.png)

![Фильтрация DATE_PART 2](./img/11_date_part_filtering_2.png)

Задача посложнее: из таблицы `user_actions` получить информацию о всех отменах заказов, которые пользователи совершали в течение августа 2022 года по средам с 12:00 до 15:59.
Результат нужно отсортировать по убыванию id отменённых заказов.

Запрос:
``` 
SELECT user_id,
       order_id,
       action,
       time
FROM   user_actions
WHERE  action = 'cancel_order'
   AND date_part('year', time) = 2022
   AND date_part('month', time) = 8
   AND date_part('dow', time) = 3
   AND date_part('hour', time) >= 12
   AND date_part('hour', time) < 16
ORDER BY order_id DESC
```

Результат:

![Фильтрация DATE_PART 3](./img/11_date_part_filtering_3.png)

#### 8. Условная логика через CASE WHEN
Имеется список товаров, на которые распространяется НДС 10%:
```
'сахар', 'сухарики', 'сушки', 'семечки', 
'масло льняное', 'виноград', 'масло оливковое', 
'арбуз', 'батон', 'йогурт', 'сливки', 'гречка', 
'овсянка', 'макароны', 'баранина', 'апельсины', 
'бублики', 'хлеб', 'горох', 'сметана', 'рыба копченая', 
'мука', 'шпроты', 'сосиски', 'свинина', 'рис', 
'масло кунжутное', 'сгущенка', 'ананас', 'говядина', 
'соль', 'рыба вяленая', 'масло подсолнечное', 'яблоки', 
'груши', 'лепешка', 'молоко', 'курица', 'лаваш', 'вафли', 'мандарины'
```

Нужно вычислить НДС каждого товара в таблице `products` и рассчитать цену без учёта НДС. Однако теперь нужно учитывать, что для товаров из списка налог составляет 10%. Для остальных товаров НДС тот же — 20%.
Нужно вывести всю информацию о товарах, включая сумму налога и цену без его учёта. Колонки с суммой налога и ценой без НДС назвать соответственно `tax` и `price_before_tax`, с округлением значений до 2-х знаков после запятой.
Результат должен быть отсортирован по убыванию цены товара без учёта НДС, затем по возрастанию id товара.

Запрос:
``` 
SELECT product_id,
       name,
       price,
       CASE WHEN name IN ('сахар', 'сухарики', 'сушки', 'семечки', 'масло льняное', 'виноград', 'масло оливковое', 'арбуз', 'батон', 'йогурт', 'сливки', 'гречка', 'овсянка', 'макароны', 'баранина', 'апельсины', 'бублики', 'хлеб', 'горох', 'сметана', 'рыба копченая', 'мука', 'шпроты', 'сосиски', 'свинина', 'рис', 'масло кунжутное', 'сгущенка', 'ананас', 'говядина', 'соль', 'рыба вяленая', 'масло подсолнечное', 'яблоки', 'груши', 'лепешка', 'молоко', 'курица', 'лаваш', 'вафли', 'мандарины') 
       THEN ROUND((price / 110) * 10, 2)
       ELSE ROUND((price / 120) * 20, 2) 
       END AS tax,
       CASE WHEN name IN ('сахар', 'сухарики', 'сушки', 'семечки', 'масло льняное', 'виноград', 'масло оливковое', 'арбуз', 'батон', 'йогурт', 'сливки', 'гречка', 'овсянка', 'макароны', 'баранина', 'апельсины', 'бублики', 'хлеб', 'горох', 'сметана', 'рыба копченая', 'мука', 'шпроты', 'сосиски', 'свинина', 'рис', 'масло кунжутное', 'сгущенка', 'ананас', 'говядина', 'соль', 'рыба вяленая', 'масло подсолнечное', 'яблоки', 'груши', 'лепешка', 'молоко', 'курица', 'лаваш', 'вафли', 'мандарины') 
       THEN ROUND(price - (price / 110) * 10, 2)
       ELSE ROUND(price - (price / 120) * 20, 2) 
       END AS price_before_tax
FROM   products
ORDER BY price_before_tax DESC, product_id
```

Результат:

![Условная логика через CASE WHEN](./img/12_case_when_filtering.png)

